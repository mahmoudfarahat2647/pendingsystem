#!/bin/sh

# Pre-commit hook: Documentation validation and reminders

# Get list of staged files
CHANGED_FILES=$(git diff --cached --name-only)

# Run documentation validation
echo "üîç Validating documentation..."
npm run docs:validate
VALIDATE_EXIT=$?

if [ $VALIDATE_EXIT -ne 0 ]; then
  echo ""
  echo "‚ùå Documentation validation failed!"
  echo "Run 'npm run docs:validate' to see detailed errors"
  exit 1
fi

# Check if component files were changed
if echo "$CHANGED_FILES" | grep -qE "src/components/"; then
  echo "‚ö†Ô∏è  Component changes detected!"
  echo ""
  echo "üìù Please remember to:"
  echo "   1. Update docs/COMPONENTS.md if documenting new complex components"
  echo "   2. Update ../features.md if adding new features"
  echo "   3. Add JSDoc comments to public component APIs"
  echo ""
fi

# Check if store files were changed
if echo "$CHANGED_FILES" | grep -qE "src/store/"; then
  echo "‚ö†Ô∏è  Store changes detected!"
  echo ""
  echo "üìù Please remember to:"
  echo "   1. Update docs/STORE_API.md with new/changed actions"
  echo "   2. Add JSDoc comments to new store actions"
  echo "   3. Update docs/ARCHITECTURE.md if core patterns changed"
  echo ""
  
  # Extract and show JSDoc summary
  echo "üí° Run 'npm run docs:extract' to see JSDoc summary"
fi

# Check if types were changed
if echo "$CHANGED_FILES" | grep -qE "src/types/"; then
  echo "‚ö†Ô∏è  Type definition changes detected!"
  echo ""
  echo "üìù Please remember to:"
  echo "   1. Update relevant documentation sections"
  echo "   2. Check if store actions need updating"
  echo ""
fi

# Run linter
echo "üîç Running Biome linter..."
npx biome check src/ --apply

exit 0
