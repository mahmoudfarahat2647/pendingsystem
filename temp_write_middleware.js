[{"next/server": "Standard sliding window rate limiter\nclass RateLimiter {\n    private requests: Map<string", "isRateLimited(identifier": "string", "limit": "number", "windowMs": "number): boolean {\n        const now = Date.now();\n        const timestamps = this.requests.get(identifier) || [];\n\n        // Remove timestamps outside the window\n        const validTimestamps = timestamps.filter((t) => now - t < windowMs);\n\n        if (validTimestamps.length >= limit) {\n            return true;"}, {"getResetTimestamp(identifier": "string", "windowMs": "number): number {\n        const timestamps = this.requests.get(identifier) || [];\n        if (timestamps.length === 0) return Date.now();\n        return Math.min(...timestamps) + windowMs;"}, {"BACKUP": {"limit": 5, "windowMs": 15, "DEFAULT": {"limit": 100, "windowMs": 60, "flow": "API routes are rate limited by IP address\n * - Different limits for backup vs general API routes\n * - Returns 429 with retry-after headers when exceeded\n *\n * Note: Authentication is handled server-side in layout.tsx and via requireAllowedUser for API routes.\n *\n * @param request - Incoming Next.js request\n * @returns Response with rate limit headers\n */\nexport async function middleware(request: NextRequest) {\n    const path = request.nextUrl.pathname;\n    const debug =\n        process.env.NODE_ENV ===", "1": "const log = (...args: unknown[]) => {\n        if (debug) {\n            // eslint-disable-next-line no-console\n            console.log(...args);"}}, ");\n    log(": "middleware] Incoming request path:", "log(": "middleware] Request URL:", "path.startsWith(\"/api": {"unknown\";\n\n    // Determine which config to use\n    const config = path.includes(\"/trigger-backup": "CONFIGS.BACKUP\n        : CONFIGS.DEFAULT;\n\n    const identifier = `${ip"}, "backup": "api"}, ["middleware] Rate limiting check for:", "identifier);\n    log(", ["middleware] Limit:", "config.limit, \"Window:", "config.windowMs, \"ms", "if (limiter.isRateLimited(identifier, config.limit, config.windowMs)) {\n        const resetTime = limiter.getResetTimestamp(identifier, config.windowMs);\n        const retryAfter = Math.ceil((resetTime - Date.now()) / 1000);\n\n        log(", ["middleware] Rate limit exceeded for:", "identifier);\n        log(", ["middleware] Retry after:", "retryAfter, \"seconds", "Return standardized error response for 429\n        return new NextResponse(\n            JSON.stringify({\n                success: false,\n                error: {\n                    code: \"RATE_LIMIT_EXCEEDED", "message: \"Too many requests. Please try again later.", "details: {\n                        retryAfterSeconds: retryAfter,\n                    },\n                },\n            }),\n            {\n                status: 429,\n                headers: {\n                    \"Content-Type\": \"application/json", "X-RateLimit-Limit", "config.limit.toString(),\n                    \"X-RateLimit-Remaining\": \"0", "X-RateLimit-Reset", "Math.ceil(resetTime / 1000).toString(),\n                    \"Retry-After", "retryAfter.toString(),\n                },\n            },\n        );\n    }\n\n    const response = NextResponse.next();\n    const remaining = limiter.getRemainingRequests(\n        identifier,\n        config.limit,\n        config.windowMs,\n    );\n    const resetTime = limiter.getResetTimestamp(identifier, config.windowMs);\n\n    // Add rate limit headers to successful responses\n    response.headers.set(\"X-RateLimit-Limit", "config.limit.toString());\n    response.headers.set(\"X-RateLimit-Remaining", "remaining.toString());\n    response.headers.set(\n        \"X-RateLimit-Reset", "Math.ceil(resetTime / 1000).toString(),\n    );\n\n    log(", ["middleware] Rate limit check passed for:", "identifier);\n    log(", ["middleware] Remaining requests:", "remaining);\n    log(", ["middleware] ===== MIDDLEWARE END =====\");\n\n    return response;\n}\n\n// Match all routes except Next.js internals\nexport const config = {\n    matcher: [\n        /*\n         * Match all request paths except:\n         * - _next/static (static files)\n         * - _next/image (image optimization files)\n         * - favicon.ico (favicon file)\n         */\n        \"/((?!_next/static|_next/image|favicon.ico).*)"]]]]]]]]